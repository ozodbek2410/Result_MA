# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ—Ç–∫–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ OMR –¥–ª—è –±–ª–æ–∫-—Ç–µ—Å—Ç–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–∞ OMR –ª–∏—Å—Ç–µ 25 –≤–æ–ø—Ä–æ—Å–æ–≤, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 27-30 –≤–æ–ø—Ä–æ—Å–æ–≤.

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω

### 1. Python —Å–∫—Ä–∏–ø—Ç –Ω–∞—Ö–æ–¥–∏—Ç –ª–∏—à–Ω–∏–µ –∫—Ä—É–≥–∏
Python —Å–∫—Ä–∏–ø—Ç `omr_color.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `cv2.HoughCircles` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫—Ä—É–≥–æ–≤ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏. –û–Ω –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å:
- –≠–ª–µ–º–µ–Ω—Ç—ã –¥–∏–∑–∞–π–Ω–∞ (—Ä–∞–º–∫–∏, –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã)
- –®—É–º –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
- –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –î—Ä—É–≥–∏–µ –∫—Ä—É–≥–ª—ã–µ –æ–±—ä–µ–∫—Ç—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Python –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 27-30 –≤–æ–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ 25.

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ QR-–∫–æ–¥—É
–î–∞–∂–µ –µ—Å–ª–∏ QR-–∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –≤–æ–ø—Ä–æ—Å–æ–≤ (25), —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Python —Å–∫—Ä–∏–ø—Ç–∞.

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ subjectId –≤ –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –±–ª–æ–∫-—Ç–µ—Å—Ç–æ–≤ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è `subjectId` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞, —á—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è–ª–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞.

## –†–µ—à–µ–Ω–∏–µ

### –£—Ä–æ–≤–µ–Ω—å 1: –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
```typescript
// server/src/routes/blockTest.routes.ts
for (const question of subjectQuestions) {
  const shuffled = shuffleVariants(question);
  shuffled.subjectId = subjectTest.subjectId; // <- –î–û–ë–ê–í–õ–ï–ù–û
  shuffledQuestions.push(shuffled);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ —Ç–µ–ø–µ—Ä—å –∑–Ω–∞–µ—Ç, –∫ –∫–∞–∫–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É –æ–Ω –æ—Ç–Ω–æ—Å–∏—Ç—Å—è.

### –£—Ä–æ–≤–µ–Ω—å 2: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞
```typescript
// server/src/routes/omr.routes.ts
// –§–∏–ª—å—Ç—Ä—É–µ–º shuffledQuestions –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º
for (const question of variantInfo.shuffledQuestions) {
  const questionSubjectId = question.subjectId?.toString();
  
  if (questionSubjectId && selectedSubjectIds.includes(questionSubjectId)) {
    const currentCount = subjectQuestionCounter.get(questionSubjectId) || 0;
    const maxCount = subjectQuestionCounts.get(questionSubjectId) || 0;
    
    if (currentCount < maxCount) {
      correctAnswers[questionNum] = question.correctAnswer;
      questionNum++;
    }
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: `correctAnswers` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ 25 –≤–æ–ø—Ä–æ—Å–æ–≤ (–ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞).

### –£—Ä–æ–≤–µ–Ω—å 3: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Python
```typescript
// server/src/routes/omr.routes.ts
if (qrFound && qrData && qrData.correctAnswers) {
  totalQuestions = Object.keys(qrData.correctAnswers).length; // 25
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º detected_answers —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–º–∏ totalQuestions
  const filteredAnswers: any = {};
  for (let i = 1; i <= totalQuestions; i++) {
    if (result.detected_answers[i]) {
      filteredAnswers[i] = result.detected_answers[i];
    }
  }
  result.detected_answers = filteredAnswers;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –î–∞–∂–µ –µ—Å–ª–∏ Python –Ω–∞—à–µ–ª 27-30 –∫—Ä—É–≥–æ–≤, –º—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 25.

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
1. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞:
   BlockTest (30 –≤–æ–ø—Ä–æ—Å–æ–≤) 
   -> StudentConfig (2 –ø—Ä–µ–¥–º–µ—Ç–∞, 25 –≤–æ–ø—Ä–æ—Å–æ–≤)
   -> shuffledQuestions (30 –≤–æ–ø—Ä–æ—Å–æ–≤ —Å subjectId)
   -> QR-–∫–æ–¥ (variantCode)

2. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ OMR:
   –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 
   -> Python (–Ω–∞—Ö–æ–¥–∏—Ç 27-30 –∫—Ä—É–≥–æ–≤)
   -> QR-–∫–æ–¥ (variantCode)
   -> –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (variant + config)
   -> –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ subjectId (25 –≤–æ–ø—Ä–æ—Å–æ–≤)
   -> correctAnswers (25 –≤–æ–ø—Ä–æ—Å–æ–≤)
   -> –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è detected_answers (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 25)
   -> –†–µ–∑—É–ª—å—Ç–∞—Ç (25 –≤–æ–ø—Ä–æ—Å–æ–≤)
```

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è totalQuestions

1. **QR-–∫–æ–¥ + correctAnswers** (—Å–∞–º—ã–π —Ç–æ—á–Ω—ã–π) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–ª–æ–∫-—Ç–µ—Å—Ç–æ–≤
2. Variant shuffledQuestions (–º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ)
3. Python rows_found (–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ª–∏—à–Ω–∏–µ)
4. Max detected answer number (fallback)

## –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: Python –Ω–∞—Ö–æ–¥–∏—Ç –º–µ–Ω—å—à–µ –∫—Ä—É–≥–æ–≤ —á–µ–º –Ω—É–∂–Ω–æ
```typescript
// –ï—Å–ª–∏ Python –Ω–∞—à–µ–ª —Ç–æ–ª—å–∫–æ 20 –∫—Ä—É–≥–æ–≤, –∞ –Ω—É–∂–Ω–æ 25
for (let i = 1; i <= totalQuestions; i++) {
  const studentAnswer = detectedAnswers[i] || null; // null –¥–ª—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö
  // ...
}
```
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ `unanswered`.

### –ü—Ä–æ–±–ª–µ–º–∞: Python –Ω–∞—Ö–æ–¥–∏—Ç –±–æ–ª—å—à–µ –∫—Ä—É–≥–æ–≤ —á–µ–º –Ω—É–∂–Ω–æ
```typescript
// –ï—Å–ª–∏ Python –Ω–∞—à–µ–ª 30 –∫—Ä—É–≥–æ–≤, –∞ –Ω—É–∂–Ω–æ 25
const filteredAnswers: any = {};
for (let i = 1; i <= totalQuestions; i++) { // —Ç–æ–ª—å–∫–æ –¥–æ 25
  if (result.detected_answers[i]) {
    filteredAnswers[i] = result.detected_answers[i];
  }
}
```
**–†–µ—à–µ–Ω–∏–µ**: –õ–∏—à–Ω–∏–µ –∫—Ä—É–≥–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

### –ü—Ä–æ–±–ª–µ–º–∞: QR-–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
```typescript
if (qrFound && qrData && qrData.correctAnswers) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º QR-–∫–æ–¥
} else if (result.rows_found > 0) {
  // Fallback –∫ Python
}
```
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑ Python (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–º).

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```
üìä Total questions (from QR correctAnswers - filtered): 25
üîß Filtered detected_answers: 27 -> 25
‚úÖ Jami 25 ta to'g'ri javob (filtered shuffled)
üìä Questions per subject: [['subject1', 15], ['subject2', 10]]
```

## –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- OMR –ª–∏—Å—Ç: 25 –≤–æ–ø—Ä–æ—Å–æ–≤
- Python –Ω–∞—Ö–æ–¥–∏—Ç: 25 –∫—Ä—É–≥–æ–≤
- QR-–∫–æ–¥: 25 –≤–æ–ø—Ä–æ—Å–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ 25 –≤–æ–ø—Ä–æ—Å–æ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Python –Ω–∞—Ö–æ–¥–∏—Ç –ª–∏—à–Ω–∏–µ –∫—Ä—É–≥–∏
- OMR –ª–∏—Å—Ç: 25 –≤–æ–ø—Ä–æ—Å–æ–≤
- Python –Ω–∞—Ö–æ–¥–∏—Ç: 27-30 –∫—Ä—É–≥–æ–≤
- QR-–∫–æ–¥: 25 –≤–æ–ø—Ä–æ—Å–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ 25 –≤–æ–ø—Ä–æ—Å–æ–≤ (–ª–∏—à–Ω–∏–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Python –Ω–∞—Ö–æ–¥–∏—Ç –º–µ–Ω—å—à–µ –∫—Ä—É–≥–æ–≤
- OMR –ª–∏—Å—Ç: 25 –≤–æ–ø—Ä–æ—Å–æ–≤
- Python –Ω–∞—Ö–æ–¥–∏—Ç: 20 –∫—Ä—É–≥–æ–≤
- QR-–∫–æ–¥: 25 –≤–æ–ø—Ä–æ—Å–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ 25 –≤–æ–ø—Ä–æ—Å–æ–≤ (5 –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ unanswered)

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: QR-–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
- OMR –ª–∏—Å—Ç: 25 –≤–æ–ø—Ä–æ—Å–æ–≤
- Python –Ω–∞—Ö–æ–¥–∏—Ç: 27 –∫—Ä—É–≥–æ–≤
- QR-–∫–æ–¥: –Ω–µ –Ω–∞–π–¥–µ–Ω
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚ö†Ô∏è 27 –≤–æ–ø—Ä–æ—Å–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Python, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω–æ)

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –°—Ç–∞—Ä—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–±–µ–∑ subjectId)
```
‚ö†Ô∏è –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (–±–µ–∑ subjectId), –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
```
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ `shuffledQuestions`
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã

### –û–±—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã (–Ω–µ –±–ª–æ–∫-—Ç–µ—Å—Ç—ã)
- –†–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ —Ç–µ—Å—Ç–∞
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–°–æ–∑–¥–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞**: +1 –ø–æ–ª–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å (subjectId) - –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ
- **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ OMR**: +1 —Ü–∏–∫–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ - O(n), –≥–¥–µ n = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤
- **–ü–∞–º—è—Ç—å**: +4 –±–∞–π—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å (ObjectId) - –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–∞ –º–µ—Å—Ç–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
