# üîß Troubleshooting E2E —Ç–µ—Å—Ç–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°–∏–º–ø—Ç–æ–º—ã
```
Error: expect(page).toHaveURL(expected) failed
Expected pattern: /\/teacher/
Received string: "http://localhost:9998/login"
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

#### 1. –ù–µ–≤–µ—Ä–Ω—ã–µ credentials

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ç–µ—Å—Ç
npx playwright test debug-auth.spec.ts --headed
```

–¢–µ—Å—Ç –ø–æ–∫–∞–∂–µ—Ç:
- –¢–µ–∫—É—â–∏–π URL
- –°—Ç–∞—Ç—É—Å API –æ—Ç–≤–µ—Ç–∞
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –°–∫—Ä–∏–Ω—à–æ—Ç (debug-login.png)

**–†–µ—à–µ–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –ë–î –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
```
login: teacher
password: teacher123
role: teacher
```

#### 2. –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd server
npm run dev
```

–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ `http://localhost:5000`

#### 3. –ö–ª–∏–µ–Ω—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd client
npm run dev
```

–ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ `http://localhost:5173`

**–í–∞–∂–Ω–æ:** –í `playwright.config.ts` —É–∫–∞–∑–∞–Ω `baseURL: 'http://localhost:9998'`

–ï—Å–ª–∏ –≤–∞—à –∫–ª–∏–µ–Ω—Ç –Ω–∞ –¥—Ä—É–≥–æ–º –ø–æ—Ä—Ç—É, –∏–∑–º–µ–Ω–∏—Ç–µ:
```typescript
// playwright.config.ts
use: {
  baseURL: 'http://localhost:5173', // –≤–∞—à –ø–æ—Ä—Ç
}
```

#### 4. API endpoint –Ω–µ–≤–µ—Ä–Ω—ã–π

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
```
http://localhost:5173/login
```

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –≤—Ä—É—á–Ω—É—é.

–°–º–æ—Ç—Ä–∏—Ç–µ:
- –ö–∞–∫–æ–π URL –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏–Ω–∞
- –ö–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
- –ö–∞–∫–æ–µ —Ç–µ–ª–æ –æ—Ç–≤–µ—Ç–∞

#### 5. CORS –ø—Ä–æ–±–ª–µ–º—ã

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ CORS –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ç–µ—Å—Ç
cd client
npx playwright test debug-auth.spec.ts --headed

# 2. –°–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç
# –ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∂–µ—Ç:
# - Current URL
# - Login API response status
# - Response body
# - Error message (if any)

# 3. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç
# debug-login.png –ø–æ–∫–∞–∂–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—Å–ª–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
```

## –ü—Ä–æ–±–ª–µ–º–∞: –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

### –°–∏–º–ø—Ç–æ–º—ã
```
Error: expect(locator).toBeVisible() failed
Locator: getByRole('heading', { name: /o'quvchilar|students/i })
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

#### 1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤—å—Ç–µ –æ–∂–∏–¥–∞–Ω–∏–µ:
```typescript
await page.waitForLoadState('domcontentloaded');
await page.waitForSelector('[data-testid="page-heading"]');
```

#### 2. –¢–µ–∫—Å—Ç –Ω–∞ –¥—Ä—É–≥–æ–º —è–∑—ã–∫–µ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞.

**–†–µ—à–µ–Ω–∏–µ:**
–û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–∫–∞—Ç–æ—Ä:
```typescript
// –ë—ã–ª–æ
page.getByRole('heading', { name: /o'quvchilar|students/i })

// –°—Ç–∞–ª–æ (–¥–æ–±–∞–≤—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç)
page.getByRole('heading', { name: /o'quvchilar|students|—É—á–∞—â–∏–µ—Å—è/i })
```

#### 3. –≠–ª–µ–º–µ–Ω—Ç –∏–º–µ–µ—Ç –¥—Ä—É–≥—É—é —Ä–æ–ª—å

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ data-testid:
```typescript
// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
<h1 data-testid="page-heading">O'quvchilar</h1>

// –í —Ç–µ—Å—Ç–µ
page.locator('[data-testid="page-heading"]')
```

## –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç —Å–ª—É—á–∞–π–Ω–æ

### –°–∏–º–ø—Ç–æ–º—ã
–¢–µ—Å—Ç—ã –∏–Ω–æ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç, –∏–Ω–æ–≥–¥–∞ –ø–∞–¥–∞—é—Ç.

### –†–µ—à–µ–Ω–∏–µ

#### 1. –£–≤–µ–ª–∏—á—å—Ç–µ timeout

```typescript
test('my test', async ({ page }) => {
  test.setTimeout(60000); // 60 —Å–µ–∫—É–Ω–¥
  // ...
});
```

#### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ auto-waiting

```typescript
// ‚ùå –ü–ª–æ—Ö–æ
await page.click('button');
await page.waitForTimeout(1000);

// ‚úÖ –•–æ—Ä–æ—à–æ
await page.waitForSelector('button');
await page.click('button');
await page.waitForResponse('/api/endpoint');
```

#### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

```typescript
// ‚ùå –ü–ª–æ—Ö–æ (–∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ)
const name = 'Test Student';

// ‚úÖ –•–æ—Ä–æ—à–æ
const name = `Test${Date.now()}`;
```

## –ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

### –°–∏–º–ø—Ç–æ–º—ã
```
Error: strict mode violation: resolved to 4 elements
```

### –†–µ—à–µ–Ω–∏–µ

```typescript
// ‚ùå –ü–ª–æ—Ö–æ
page.getByRole('link', { name: /tests/i })

// ‚úÖ –•–æ—Ä–æ—à–æ
page.getByRole('link', { name: /tests/i }).first()

// –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä
page.getByRole('link', { name: /^tests$/i })
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π

```bash
# Debug —Ä–µ–∂–∏–º (–ø–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
npx playwright test --debug

# Headed —Ä–µ–∂–∏–º (–≤–∏–¥–∏–º—ã–π –±—Ä–∞—É–∑–µ—Ä)
npx playwright test --headed

# Slow motion (–∑–∞–º–µ–¥–ª–µ–Ω–∏–µ)
npx playwright test --headed --slow-mo=1000

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
npx playwright test debug-auth.spec.ts --headed
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# HTML –æ—Ç—á–µ—Ç
npm run test:e2e:report

# –¢—Ä–µ–π—Å—ã
npx playwright show-trace trace.zip

# –°–∫—Ä–∏–Ω—à–æ—Ç—ã
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ test-results/
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
npx playwright codegen http://localhost:5173
```

## –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤

- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (`cd server && npm run dev`)
- [ ] –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—É—â–µ–Ω (`cd client && npm run dev`)
- [ ] –í –ë–î –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (teacher/teacher123)
- [ ] –ü–æ—Ä—Ç –≤ `playwright.config.ts` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–æ—Ä—Ç–æ–º –∫–ª–∏–µ–Ω—Ç–∞
- [ ] –ù–µ—Ç –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ —Ç–æ–º –∂–µ –ø–æ—Ä—Ç—É

## –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ï—Å–ª–∏ –≤ –ë–î –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `teacher`, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ:

```bash
cd server
npm run script:createAdmin
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ MongoDB Compass/mongosh
```

–ò–ª–∏ —á–µ—Ä–µ–∑ mongosh:
```javascript
use resultma

db.users.insertOne({
  username: 'teacher',
  password: '$2a$10$...' // —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π teacher123
  role: 'teacher',
  branchId: ObjectId('...'),
  createdAt: new Date()
})
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–º–æ—â–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `npx playwright test debug-auth.spec.ts --headed`
2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥ –∫–æ–Ω—Å–æ–ª–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `debug-login.png`

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2026-02-14  
**–í–µ—Ä—Å–∏—è:** 1.0.0
